#!/usr/bin/env python3
# Copyright 2020 David Boyd, all rights reserved
# Program: ping-sweeper.py
# Description:
#     Ping sweeper that uses multithreading.
# Date: 2020-02-03
# Revised:
#    2020-02-05 - Chg context mgr to 'Threading' =~ 21 sec
#    2020-02-04

import concurrent.futures
import os
import subprocess
import time

t1 = time.perf_counter()

start = 1
end = 254
iphost = "172.16.2."

def ping_me(ip):
    try:
        DEVNULL = open(os.devnull, 'w')
        subprocess.check_call(['ping','-c1',ip], stdout=DEVNULL)
        print(ip)
    except:
        pass

if __name__ == "__main__":

    # Create ip list
    iplist = []
    for i in range(start, end+1):
       iplist.append(str(iphost)+str(i))

    # Context Manager  -- can change to .ProcessPoolExe...
    with concurrent.futures.ThreadPoolExecutor() as executor:
        executor.map(ping_me, iplist)

    t2 = time.perf_counter()
    #print("Total time: ", t2-t1)
