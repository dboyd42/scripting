#!/bin/bash
# Copyright 2020 David Boyd, all rights reserved
# Program: axfr.sh
# Description:
#     --Zone Transfer--
#     Uses a wordlist to find common server names
#     Then attempts a zone transfer on each server found
# Dependencies: default wordlist: DNSenum
# Date: 2020-02-15
# Revised:

w3="www."
serverArray=()  # Server names

# Check if argument was given, if not, print usage
if [ -z "$1" ]; then
    echo "[*] Zone Transfer"
    echo "[*] Usage    : $0 <domain name> "
    exit 0
fi

# Determine if argument has 'www.'
case "$1" in
    *www.*)
        domain=${1/#$w3}
        w3domain="$1"
        classC_IP=$(host $1 | cut -d' ' -f4 | cut -d'.' -f1-3)
        ;;
    *)
        domain="$1"
        w3domain="$w3$1"
        classC_IP=$(host $w3$1 | cut -d' ' -f4 | cut -d'.' -f1-3)
        ;;
esac

# Attempt AXFR
for server in $(cat /usr/share/dnsenum/dns.txt); do
    serv1=$(host $server.$domain |grep -v "not found" | cut -d' ' -f1)
    if [ ! -z "$serv1" ]; then
        echo -e "\n+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+"
        echo -e "+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+\n"
        echo "Attempting AXFR on $serv1..."
        echo "============================"
        host -l $domain $serv1 #| grep "has address"
    fi
done

