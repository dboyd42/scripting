#!/bin/bash
# Copyright 2020 David Boyd, all rights reserved
# Program: wget-subdomain-ip.sh
# Description:
#     Get subdomains and their corresponding IP addresses
# Date: 2020-01-21
# Revised:
# Notes: file delimeter = ' '
# Warnings: only works for 'index.html' sites

# $1 = website
# $2 = save file for: subdomains ip-addresses
# $3 = save file for: ip-addresses

###
### Argument Checkers
###
# Check for website ARGV
if [ -x $1 ]; then
    echo "-------------------------------------------------------------------------"
    echo "Try './wget-subdomain-ip.sh    <website>'"
    echo "Or  './wget-subdomain-ip.sh    <website>   <save-to.file>'"
    echo "Or  './wget-subdomain-ip.sh    <website>   <save-to.file> <ip-saveFile>'"
    echo "-------------------------------------------------------------------------"
    echo "IE#  ./wget-subdomain-ip.sh www.google.com subdomains.txt ipaddresses.txt"
    echo "-------------------------------------------------------------------------"
    exit
fi

# Extract 'www.' if in $1
if [ "${1:0:4}" == "www." ]; then
    domain="$(echo ${1:4})"
else
    domain=$1
fi

###
### Get subdomains
###
#wget robots=off $1 2>/dev/null  # Uncomment will d/l entire site
wget $1 2>/dev/null

# Grep the subdomains from the website
subdomains=($(grep -o '[a-zA-Z0-9_\.-]*\.*'$domain'' index.html | sort -u))

###
### Write to terminal or file
###
if [ -n "$2" ]; then
    # Get IP addresses
    for url in "${subdomains[@]}"; do
        # Write to file
        printf "%s %s\n" $url $(host $url | grep "has address" | \
            cut -d " " -f4) >> $2
    done
else
    echo "To write to file, try: './wget-subdomain-ip.sh <website>' <filename>"
    echo "--------------------------------------------------------------------"
    # Get IP addresses
    for url in "${subdomains[@]}"; do
        # echo to terminal
        printf "%s %s\n" $url $(host $url | grep "has address" | \
            cut -d " " -f4)
    done
fi

# Write IP addresses to file
if [ -n "$3" ]; then
    cat $2 | cut -d ' ' -f2 | grep "\S" >> $3
fi

###
### Clean up directory
###
rm index.html

